{% extends 'layout.html' %}

{% block content %}
<div class="card">
    <div
        style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 1rem; margin-bottom: 1rem;">
        <div>
            <h2 style="margin: 0;">Team Roaster</h2>
            <div style="margin-top: 0.5rem;">
                <a href="{{ url_for('roaster', view='weekly', month=current_month, year=current_year) }}"
                    class="btn {% if view_type == 'weekly' %}btn-primary{% else %}btn-secondary{% endif %}"
                    style="padding: 0.3rem 0.8rem; font-size: 0.8rem; text-decoration: none;">Weekly</a>
                <a href="{{ url_for('roaster', view='monthly', month=current_month, year=current_year) }}"
                    class="btn {% if view_type == 'monthly' %}btn-primary{% else %}btn-secondary{% endif %}"
                    style="padding: 0.3rem 0.8rem; font-size: 0.8rem; text-decoration: none;">Monthly</a>
            </div>
        </div>

        <div style="display: flex; align-items: center; gap: 1rem;">
            <form action="{{ url_for('roaster') }}" method="GET"
                style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="hidden" name="view" value="{{ view_type }}">
                <select name="month" class="form-control" style="width: auto; padding: 0.4rem;"
                    onchange="this.form.submit()">
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if m==current_month %}selected{% endif %}>{{ datetime(current_year, m,
                        1).strftime('%B') }}</option>
                    {% endfor %}
                </select>
                <select name="year" class="form-control" style="width: auto; padding: 0.4rem;"
                    onchange="this.form.submit()">
                    {% for y in range(current_year - 1, current_year + 2) %}
                    <option value="{{ y }}" {% if y==current_year %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
            </form>
            <button class="btn btn-primary" onclick="window.print()">Print</button>
        </div>
    </div>


    <div style="overflow-x: auto;">
        <table class="roaster-table">
            <thead>
                <tr>
                    <th>Member</th>
                    {% for date in dates %}
                    <th>{{ date.strftime('%a, %d %b') }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td style="font-weight: 600;">{{ user.username }}</td>
                    {% for date in dates %}
                    <td class="shift-cell">
                        {% set shift = roaster_data[user.id][date] %}
                        {% if current_user.role == 'Admin' %}
                        <form action="{{ url_for('assign_shift') }}" method="POST">
                            <input type="hidden" name="user_id" value="{{ user.id }}">
                            <input type="hidden" name="date" value="{{ date.strftime('%Y-%m-%d') }}">
                            <select name="shift_type" onchange="this.form.submit()" class="form-control"
                                style="padding: 0.2rem; font-size: 0.8rem;">
                                <option value="Off" {% if shift=='Off' or not shift %}selected{% endif %}>Off</option>
                                <option value="Morning" {% if shift=='Morning' %}selected{% endif %}>Morning</option>
                                <option value="Afternoon" {% if shift=='Afternoon' %}selected{% endif %}>Afternoon
                                </option>
                                <option value="Night" {% if shift=='Night' %}selected{% endif %}>Night</option>
                            </select>
                        </form>
                        {% else %}
                        <span class="shift-tag shift-{{ shift if shift else 'Off' }}">
                            {{ shift if shift else 'Off' }}
                        </span>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    @media print {

        .navbar,
        .btn,
        select {
            display: none;
        }

        .card {
            box-shadow: none;
            border: none;
        }
    }
</style>
{% endblock %}